# Инструкция по установке Funpay Price Analyzer

## Требования

### Для расширения:
- Google Chrome 88+ / Microsoft Edge 88+ / Firefox 89+
- Активный аккаунт на Funpay.com

### Для backend API:
- Node.js 16.x или выше
- npm 7.x или выше
- 512 MB свободной оперативной памяти

## Установка Backend API

### Шаг 1: Установка зависимостей

```bash
cd backend
npm install
```

### Шаг 2: Настройка окружения

Backend уже настроен с файлом `.env`. Если нужно изменить порт или другие настройки:

```bash
# Отредактируйте файл .env
nano .env
```

Доступные настройки:
- `PORT` - порт для API сервера (по умолчанию 3000)
- `RATE_LIMIT_MAX_REQUESTS` - максимум запросов в период (по умолчанию 100)
- `FUNPAY_REQUEST_DELAY` - задержка между запросами к Funpay в мс (по умолчанию 1000)

### Шаг 3: Запуск сервера

**Обычный режим:**
```bash
npm start
```

**Режим разработки (с auto-reload):**
```bash
npm run dev
```

Сервер будет доступен на `http://localhost:3000`

### Проверка работы API

```bash
curl http://localhost:3000/api/health
```

Должен вернуть:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "version": "1.0.0"
}
```

## Установка расширения

### Google Chrome / Microsoft Edge

1. Скачайте или клонируйте репозиторий
2. Откройте Chrome/Edge и перейдите по адресу:
   - Chrome: `chrome://extensions/`
   - Edge: `edge://extensions/`

3. Включите "Режим разработчика" (Developer mode) в правом верхнем углу

4. Нажмите "Загрузить распакованное расширение" (Load unpacked)

5. Выберите папку `extension` из репозитория

6. Расширение появится в списке расширений

### Mozilla Firefox

1. Откройте Firefox и перейдите по адресу: `about:debugging#/runtime/this-firefox`

2. Нажмите "Загрузить временное дополнение" (Load Temporary Add-on)

3. Выберите файл `extension/manifest.json`

4. Расширение будет активно до перезапуска Firefox

**Примечание для Firefox:** Для постоянной установки нужно подписать расширение через Firefox Add-ons.

## Первоначальная настройка

### 1. Генерация API ключа

После установки расширения:

1. Нажмите на иконку расширения в панели браузера
2. Нажмите "Сгенерировать API ключ"
3. Введите ваш email
4. Скопируйте сгенерированный ключ в буфер обмена
5. Нажмите "Сохранить ключ"

### 2. Аутентификация на Funpay

1. Откройте [funpay.com](https://funpay.com) в новой вкладке
2. Войдите в свой аккаунт Funpay
3. Вернитесь в расширение
4. Нажмите "Войти через Cookies"
5. Расширение автоматически получит доступ к вашей сессии

### 3. Проверка работы

1. Откройте любую страницу товара на Funpay
2. На странице должна появиться кнопка "Анализ цен"
3. Нажмите на неё для проверки анализа
4. Или откройте popup расширения для детального анализа

## Распространенные проблемы

### Расширение не загружается

**Проблема:** Ошибка при загрузке расширения  
**Решение:** 
- Убедитесь, что загружаете папку `extension`, а не весь репозиторий
- Проверьте, что файлы manifest.json и все скрипты на месте
- Перезагрузите страницу расширений

### API сервер не запускается

**Проблема:** Порт 3000 уже занят  
**Решение:**
```bash
# Измените порт в .env файле
echo "PORT=3001" > backend/.env
```

**Проблема:** Ошибки зависимостей  
**Решение:**
```bash
cd backend
rm -rf node_modules package-lock.json
npm install
```

### Расширение не видит API

**Проблема:** Не удается подключиться к API  
**Решение:**
- Убедитесь, что backend сервер запущен (`npm start`)
- Проверьте, что порт в `extension/shared/config.js` совпадает с портом API
- Проверьте консоль браузера на наличие CORS ошибок

### Cookies не работают

**Проблема:** Ошибка аутентификации через cookies  
**Решение:**
- Убедитесь, что вы вошли на funpay.com в том же браузере
- Проверьте, что cookies разрешены для funpay.com
- Попробуйте выйти и снова войти на Funpay
- Очистите cookies расширения и попробуйте снова

### Анализ не работает

**Проблема:** Не получается проанализировать цены  
**Решение:**
- Проверьте, что API ключ введен правильно
- Откройте консоль разработчика (F12) и проверьте ошибки
- Убедитесь, что находитесь на странице товара Funpay
- Проверьте, что backend API запущен и отвечает

## Обновление

### Обновление расширения

1. Загрузите новую версию из репозитория
2. Перейдите на страницу расширений
3. Нажмите кнопку обновления (⟳) рядом с расширением
4. Или удалите старую версию и загрузите новую

### Обновление backend

```bash
cd backend
git pull origin main
npm install
npm start
```

## Удаление

### Удаление расширения

1. Перейдите на страницу расширений браузера
2. Найдите "Funpay Price Analyzer"
3. Нажмите "Удалить"

### Удаление backend

```bash
cd backend
npm stop  # Остановите сервер если запущен
cd ..
rm -rf backend
```

### Очистка данных

Расширение хранит данные в `chrome.storage.local`. Для полной очистки:

1. Откройте страницу настроек расширения
2. Нажмите "Сбросить все настройки"
3. Или вручную очистите через Developer Tools > Application > Storage

## Дополнительная помощь

Если проблема не решена:
- Проверьте [Issues на GitHub](https://github.com/funpay-analyzer/issues)
- Откройте новый Issue с описанием проблемы
- Напишите на support@funpayanalyzer.com
